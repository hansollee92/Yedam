<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<!-- jQuery CDN -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>
	<!-- p139-141 -->
	<form>
		제목: <input id="title"><br/>
		작성자: <input id="author"><br/>
		글내용: <textarea rows="3" cols="50" id="content"></textarea>
		<button type="button" id="btn-save">등록</button>
	</form>
	
	<script>
		var main = {
			init : function(){
				// 버튼클릭 이벤트
				var _this = this;   // this를 작성하는 이유는 main객체를 this로 사용하기 위해서이다. 그냥 function안에서 this쓰면 그 자체를 의미하기 때문에
				$("#btn-save").on("click", () => {
					_this.save();
				})
				// view에서 보면 onMounted와 비슷한 형태임 현재
				// 객체의 형태로 함수들을 정리하고 있는데 이게 익숙하지 않다면 function init(){}, function save(){}라고 해서 init(); 이렇게 호출해도 됨
			},
			save : function(){
				
				// 글 등록이 되어 있지 않다면(유효성체크)
				if(! $("#content").val()){
					alert("글을 작성해주세요.");
					return;
				}
				
				var data = {
						title : $("#title").val(),
						content : $("#content").val(), 
						author : $("#author").val()
				}
				
				// ajax
				$.ajax({
					// ajax 호출 
					url: "/api/v1/posts",    //controller 주소보고 넣기
					type : 'POST',
					contentType : "application/json; charset=utf-8",   //@RequestBody가 있다면 이거 넣어줘야함
					data: JSON.stringify(data)  //위의 data가 객체형태이기때문에 그냥 data라고 적으면 쿼리스트링으로 보내기 때문에 JSON형식으로 변경해줘야함
					                            // 즉 정리하자면, @RequestBody가 있다면 contentType, data 둘다 작성해야한다.
				}).done((result) => {
					alert("글이 등록되었습니다.");
					location.href="/";   // 페이지이동할 곳 작성
				})
				.fail(error => {
					alert(error);
				});
				
			} // end of save
		}; // end of main
		
		main.init();
	
	</script>
</body>
</html>