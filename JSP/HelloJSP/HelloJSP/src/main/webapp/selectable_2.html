<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<script src='./dist/index.global.js'></script>
<script>
                           
  document.addEventListener('DOMContentLoaded', async function() {
  //async로 선언된 함수 안에서만 await를 사용할 수 있다.

	  // 값을 담을 변수 선언
	  let eventList = [
		  	{title: "test", start: "2023-01-04"}
	  ];	  
	  // ajax 실행
	  let result = await fetch('eventList.do');
	  let data = await result.json();
	  eventList = data;
	  
	  var calendarEl = document.getElementById('calendar');
	  var calendar = new FullCalendar.Calendar(calendarEl, {
	    headerToolbar: {
	      left: 'prev,next today',
	      center: 'title',
	      right: 'dayGridMonth,timeGridWeek,timeGridDay'
	    },
	    initialDate: new Date(),
	    navLinks: true, // can click day/week names to navigate views
	    selectable: true,
	    selectMirror: true,
	    select: async function(arg) {   //추가할때 실행되는 메소드
	      var title = prompt('일정을 등록하세요!');
	      if (title) {
		  		let resolve = await fetch('addEvent.do?title='+title+'&start='+arg.startStr+'&end='+arg.endStr);
		  		let result = await resolve.json();
				if(result.retCode == 'OK'){
				    calendar.addEvent({ //캘린더에 일정을 추가
			            title: title,
			            start: arg.start,
			            end: arg.end,
			            allDay: arg.allDay
			         })
		  		}else if(result.retCode == 'NG'){
		  			alert('실패발생');
		  		}	        	
	      }//end of if.0
	      calendar.unselect();
	    },
	    eventClick: async function(arg) {   //삭제할때 실행되는 메소드 
			console.log(arg);
	      		if (confirm('일정을 삭제하시겠습니까?')) {	
		    	  		let resolve = await fetch('removeEvent.do?title='+arg.event.title);
		    	  		let result = await resolve.json();
		    	  		if(result.retCode == 'OK'){
		    	  			arg.event.remove();	
		    	  		}else if(result.retCode == 'NG'){
		    	  			alert('실패발생');
		    	  		}
	             }//end of if.
	    },
	    editable: true,
	    dayMaxEvents: true, // allow "more" link when too many events
	    events: eventList
	  });
	
	  calendar.render();
	    

  }); // end of DOMContentLoaded.

</script>
<style>
body {
	margin: 40px 10px;
	padding: 0;
	font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
	font-size: 14px;
}

#calendar {
	max-width: 1100px;
	margin: 0 auto;
}
</style>
</head>
<body>

	<div id='calendar'></div>

</body>
</html>
